{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}RedVibe{% endblock %}</title>

  <link rel="icon" href="{% static 'images/favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/reels.css' %}">
</head>
<body>

  <!-- Sidebar (only on home page) -->
  {% if request and request.resolver_match and request.resolver_match.url_name == "home" %}
  <div class="sidebar">
    <a href="{% url 'home' %}" title="Home">🏠</a>
    <a href="{% url 'reels' %}" title="Reels">🎥</a>
    <a href="{% url 'upload' %}" title="Upload">➕</a>

    {% if user.is_authenticated %}
      <a href="{% url 'profile' user.id %}" title="Profile">👤</a>
      <form action="{% url 'accounts:logout' %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit">🚪</button>
      </form>
    {% else %}
      <a href="{% url 'accounts:login' %}" title="Login">🔐</a>
      <a href="{% url 'accounts:signup' %}" title="Sign up">📝</a>
    {% endif %}
  </div>
  {% endif %}

  <!-- Header -->
  <header>
    <div class="logo">
      <a href="{% url 'home' %}">RedVibe</a>
      <div class="age-warning">🔞 18+ Only</div>
    </div>
    <div class="header-right">
      {% if user.is_authenticated %}
        <span class="header-user">Hi, {{ user.username }}</span>
        <form action="{% url 'accounts:logout' %}" method="post">
          {% csrf_token %}
          <button type="submit">Logout</button>
        </form>
      {% else %}
        <a href="{% url 'accounts:login' %}">Login</a> |
        <a href="{% url 'accounts:signup' %}">Sign up</a>
      {% endif %}
    </div>
  </header>

  <!-- Main Content -->
  <main>
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 RedVibe. All rights reserved.</p>
  </footer>

  <!-- CSRF helper for JS -->
  <script>
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.startsWith(name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    window.CSRF_TOKEN = getCookie('csrftoken');
  </script>

  <script src="{% static 'js/main.js' %}"></script>
  {% block extra_js %}{% endblock %}
</body>
</html>
