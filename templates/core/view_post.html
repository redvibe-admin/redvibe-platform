{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} - RedVibe{% endblock %}

{% block content %}
<div class="reel-container">
    <!-- Video / Image Display -->
    {% if post.file %}
        {% with post.file.name|slice:"-4:" as file_ext %}
            {% if file_ext == ".mp4" or file_ext == ".mov" %}
                <video src="{{ post.file.url }}" class="reel-video" autoplay muted playsinline></video>
            {% elif file_ext == ".jpg" or file_ext == ".png" or file_ext == ".jpeg" %}
                <img src="{{ post.file.url }}" alt="{{ post.title }}">
            {% endif %}
        {% endwith %}
    {% endif %}

    <!-- Overlay Buttons -->
    <div class="reel-overlay">
        <!-- Like Button -->
        {% if user.is_authenticated %}
            <button class="like-btn" data-id="{{ post.id }}">
                {% if user in post.likes.all %}
                    Unlike ‚ù§Ô∏è
                {% else %}
                    ‚ù§Ô∏è Like
                {% endif %}
            </button>
        {% else %}
            <p><a href="{% url 'login' %}">Login</a> to like</p>
        {% endif %}

        <!-- Report Button -->
        {% if user.is_authenticated %}
            <button id="reportBtn">üö© Report</button>
        {% else %}
            <p><a href="{% url 'login' %}">Login</a> to report</p>
        {% endif %}
    </div>

    <!-- Comments Section -->
    <div class="comments-section" id="comments-{{ post.id }}">
        <h3>Comments</h3>
        {% for comment in post.comments.all %}
            <div class="comment">
                <strong>{{ comment.user.username }}</strong>: {{ comment.text }}
                <small>{{ comment.created_at|date:"M d, Y H:i" }}</small>
            </div>
        {% empty %}
            <p>No comments yet.</p>
        {% endfor %}
    </div>

    <!-- Comment Form -->
    {% if user.is_authenticated %}
        <div class="comment-form">
            <form method="POST" action="{% url 'comment' post.id %}">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button type="submit">Submit</button>
            </form>
        </div>
    {% else %}
        <p><a href="{% url 'login' %}">Login</a> to comment</p>
    {% endif %}
</div>

<!-- Report Modal -->
<div id="reportModal" class="report-modal" style="display:none;">
    <div class="report-content">
        <span id="closeReport" class="close-btn">&times;</span>
        <h3>Report Post</h3>
        <form method="POST" action="{% url 'report' post.id %}">
            {% csrf_token %}
            <label for="reason">Reason:</label>
            <select name="reason" required>
                <option value="">Select reason</option>
                <option value="Nudity">Nudity</option>
                <option value="Violence">Violence</option>
                <option value="Spam">Spam</option>
                <option value="Other">Other</option>
            </select>
            <textarea name="details" placeholder="Additional details (optional)"></textarea>
            <button type="submit">Submit Report</button>
        </form>
    </div>
</div>

<!-- JS -->
<script src="{% static 'js/main.js' %}"></script>
{% endblock %}
